# 🔍 回程日期問題快速診斷

## 問題現象
從你的 Console 輸出可以看到：
- ✅ 找到了候選航班（東京 NRT → 台北 TPE）
- ✅ 出發地匹配：true
- ✅ 目的地匹配：true
- ❌ **日期匹配：false** ← 問題在這裡！
- 結果：找到 0 個回程航班

## 可能的原因

### 原因 1: 回程日期沒有被正確傳遞或保存
從你的截圖看，候選航班的日期都是 `2024-10-22`, `2024-10-23`, `2024-10-24`, `2024-10-25`，但這些都不匹配你選擇的回程日期。

### 原因 2: `returnDate` 可能是空字串或 undefined
如果 `returnDate` 狀態沒有被正確設置，`returnDateToUse` 可能會退回到使用 `displayDate`，而 `displayDate` 可能不是回程日期。

## 🧪 請提供以下 Console 資訊

請在 Console 中找到並複製以下資訊：

### 1. 搜尋表單提交時：
```
========== SearchForm - 提交搜尋 ==========
票種: ???
出發地: ???
目的地: ???
出發日期 (state): ???
回程日期 (state): ???  ← 這個很重要！
艙等: ???
==========================================
✓ 實際傳送的資料: { ... }  ← 這個也很重要！
✓ returnDate 會傳送嗎? ???
```

### 2. HomePage 接收搜尋參數時：
```
============ 開始搜尋航班 ============
搜尋類型: ???
出發地: ???
目的地: ???
出發日期: ???
回程日期: ???  ← 這個很重要！
艙等: ???
====================================
✓ 設置回程日期範圍: ??? → ???
```

### 3. 選擇去程航班後：
```
============ 選擇去程航班，準備顯示回程航班 ============
searchParams.returnDate: ???  ← 這個很重要！
selectedDateRange: { start: ???, end: ??? }  ← 這個也很重要！
displayDate: ???
最終使用的回程日期: ???  ← 這個最重要！
```

## 🔧 臨時測試方案

如果你想快速測試，可以嘗試：

1. **清空瀏覽器緩存和 LocalStorage**
   - F12 → Application → Storage → Clear site data
   
2. **重新整理頁面** (Ctrl+R 或 Cmd+R)

3. **重新測試**：
   - 來回票
   - 台北 TPE → 東京 NRT
   - 出發：2024-10-17
   - 回程：2024-10-19 ← 請確認在日曆中確實選擇了這個日期

## 📋 完整測試步驟

1. 打開 http://localhost:5175/
2. 打開 Console (F12)
3. 選擇「來回」
4. 出發地：台北 TPE
5. 目的地：東京 NRT
6. **點擊「出發日期」欄位**，選擇 2024-10-17
7. **點擊「回程日期」欄位**，選擇 2024-10-19
   - ⚠️ 確認回程日期輸入框中顯示的是 2024/10/19
8. 艙等：經濟艙
9. 點擊「搜尋航班」
10. 查看 Console，複製所有輸出
11. 選擇一個去程航班
12. 查看 Console，複製所有輸出

## 🎯 預期的正確輸出

如果一切正常，應該看到：

```
========== SearchForm - 提交搜尋 ==========
回程日期 (state): 2024-10-19  ← 應該有值
✓ 實際傳送的資料: { ..., returnDate: "2024-10-19" }
✓ returnDate 會傳送嗎? 是 (2024-10-19)

============ 開始搜尋航班 ============
回程日期: 2024-10-19  ← 應該有值
✓ 設置回程日期範圍: 2024-10-17 → 2024-10-19

============ 選擇去程航班，準備顯示回程航班 ============
searchParams.returnDate: 2024-10-19  ← 應該有值
selectedDateRange: { start: "2024-10-17", end: "2024-10-19" }  ← 兩個都應該有值
最終使用的回程日期: 2024-10-19  ← 應該是 2024-10-19

✓ 找到候選航班: JX446, 日期=2024-10-19, ...
  匹配結果: 出發=true, 目的=true, 日期=true  ← 日期應該是 true！
✓ 找到 2 個回程航班
```

## 🐛 如果還是不行

請將完整的 Console 輸出（從按「搜尋航班」開始到「找到 0 個回程航班」結束）複製給我！

