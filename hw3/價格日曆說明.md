# 價格日曆功能說明

## ✨ 功能概述

**價格日曆** 會在使用者搜尋航班後自動顯示，展示**指定日期前後各2天**的票價，方便使用者比較並選擇最優惠的日期。

## 📅 顯示時機

**會顯示：**
- ✅ 來回票
- ✅ 單程票

**不會顯示：**
- ❌ 多程票（因為每程日期獨立）

## 🎯 功能說明

### 1. 價格顯示
```
10/14    10/15    10/16    10/17    10/18
週六     週日     週一     週二     週三
$9.8k    $10.2k   $8.5k    $8.7k    $9.0k
(週末)   (週末)            (已選)
```

**顯示內容：**
- 📅 日期（月/日）
- 📆 星期幾
- 💰 該日最低價（以K為單位，如 $8.5k = NT$8,500）
- 🔴 週末標示（紅色背景）
- ✓ 已選日期標記（金色高亮 + 打勾）

### 2. 導航按鈕

**‹ 前一天**
- 整個日曆往前移動一天
- 例如：10/14-10/18 → 10/13-10/17

**後一天 ›**
- 整個日曆往後移動一天
- 例如：10/14-10/18 → 10/15-10/19

### 3. 點擊日期切換

**功能：**
- 點擊任一日期卡片
- 自動切換到該日期
- **重新搜尋該日期的航班**
- 航班列表即時更新

**效果：**
```
原本搜尋：10/16（週一）→ 顯示週一的航班
點擊 10/17（週二）→ 立即顯示週二的航班
```

## 💡 使用範例

### 範例 1：找最便宜的日期

1. **搜尋航班**
   - 台北 → 東京
   - 出發日期：10/16

2. **查看價格日曆**
   ```
   10/14: $9.8k (週六)
   10/15: $10.2k (週日)
   10/16: $8.5k (週一) ← 目前選擇
   10/17: $8.7k (週二)
   10/18: $9.0k (週三)
   ```

3. **發現週一最便宜**
   - 目前已經是 10/16（週一）
   - 繼續選擇航班

4. **或者點擊其他日期**
   - 點擊 10/14（週六）$9.8k
   - 航班列表立即切換到週六的航班
   - 如果覺得不錯，可以選擇週六的航班

### 範例 2：使用導航按鈕

1. **搜尋航班**
   - 台北 → 東京
   - 出發日期：10/20

2. **想看更早的日期**
   - 點擊「‹ 前一天」
   - 日曆變成：10/18-10/22
   - 再點「‹ 前一天」
   - 日曆變成：10/17-10/21

3. **想看更晚的日期**
   - 點擊「後一天 ›」
   - 日曆往後移動

4. **找到理想日期**
   - 點擊日期卡片
   - 航班列表更新
   - 選擇航班

## 🎨 視覺設計

### 日期卡片狀態

**一般日期：**
- 灰色背景（var(--secondary-color)）
- 白色文字

**週末日期：**
- 紅色背景（淡紅色）
- 價格通常較高

**已選日期：**
- 金色漸層背景
- 深色文字
- 右上角打勾 ✓
- 陰影效果

**Hover 效果：**
- 卡片上浮
- 金色邊框
- 增強陰影

### 導航按鈕

**設計：**
- 圓角按鈕
- 金色文字
- 灰色背景

**Hover：**
- 放大 1.1 倍
- 金色邊框

## 💰 價格計算邏輯

### 基準價格
從該航線所有航班中找出最低價（依艙等）

### 價格變化因素
1. **週末加價**：週六、週日 +15%
2. **日期波動**：不同日期有小幅波動（±2-20%）
3. **艙等差異**：
   - 經濟艙：基準價
   - 商務艙：約 3 倍
   - 頭等艙：約 5 倍

### 顯示格式
- 原價：NT$ 8,500
- 日曆顯示：$8.5k
- 方便快速比較

## 🔄 互動流程

```
使用者搜尋航班（10/16）
    ↓
顯示價格日曆（10/14-10/18）
    ↓
顯示 10/16 的航班列表
    ↓
使用者點擊 10/17
    ↓
航班列表更新為 10/17 的航班
    ↓
使用者可以選擇 10/17 的航班
```

## ⚙️ 技術實現

### 日期範圍生成
```typescript
// 前2天到後2天（共5天）
for (let i = -2; i <= 2; i++) {
  const date = new Date(baseDate)
  date.setDate(date.getDate() + i)
  dates.push(date.toISOString().split('T')[0])
}
```

### 點擊日期處理
```typescript
const handleDateSelect = (date: string) => {
  setDisplayDate(date)           // 更新顯示日期
  
  // 重新搜索該日期的航班
  const filtered = flights.filter(flight => {
    const departureMatch = flight.departure.includes(searchParams.departure)
    const destinationMatch = flight.destination.includes(searchParams.destination)
    return departureMatch && destinationMatch
  })
  setFilteredFlights(filtered)   // 更新航班列表
}
```

## 📱 響應式設計

### 桌面版（> 968px）
- 左右排列：[‹ 前一天] [日期卡片...] [後一天 ›]
- 日期卡片橫向滾動

### 平板/手機版（≤ 968px）
- 上下排列：
  ```
  [日期卡片...]
  [‹ 前一天]
  [後一天 ›]
  ```
- 按鈕全寬顯示

## ✅ 測試步驟

### 基本測試
1. 選擇來回票或單程票
2. 選台北 → 東京，日期 10/16
3. 搜尋航班
4. **應該看到：**
   - 價格日曆顯示在航班列表上方
   - 5個日期卡片（10/14-10/18）
   - 10/16 是金色高亮（已選）
   - 前一天、後一天按鈕

### 日期切換測試
1. 點擊 10/17（週二）
2. **應該看到：**
   - 日曆中 10/17 變成金色高亮
   - 航班列表更新（還是台北→東京的航班）
   - 搜尋日期顯示：10/17

3. 點擊「‹ 前一天」
4. **應該看到：**
   - 日曆變成 10/13-10/17
   - 航班列表更新為 10/16 的航班

5. 點擊「後一天 ›」
6. **應該看到：**
   - 日曆變成 10/14-10/18
   - 航班列表更新為 10/17 的航班

## 🎯 關鍵優勢

### 使用者體驗
- 👀 **一目了然** - 5天價格並排顯示
- 🖱️ **一鍵切換** - 點擊就能看其他日期航班
- 💰 **價格比較** - 輕鬆找出最優惠日期
- 📅 **靈活選擇** - 不用重新填寫搜尋表單

### 實用場景
- 彈性出發日期的旅客
- 想找最便宜機票的使用者
- 比較週末與平日價格
- 快速查看連假前後價格

## 📝 注意事項

1. **價格為模擬**
   - 目前使用演算法模擬價格波動
   - 實際應該從資料庫查詢真實價格

2. **週末較貴**
   - 週六、日自動加價 15%
   - 符合真實市場情況

3. **多程票不顯示**
   - 因為每程日期獨立
   - 無法用單一日曆表示

4. **點擊日期後**
   - 航班列表會重新搜尋
   - 但出發地和目的地不變
   - 只是換了日期

---

**功能狀態：** ✅ 完整實現  
**測試狀態：** ✅ 建置成功  
**使用說明：** 搜尋後即可看到價格日曆，點擊日期立即切換航班！

