# 回程航班測試說明

## 🔧 修正內容

### 問題診斷
回程航班無法顯示的原因是：
1. `handleSearch` 沒有初始化 `departureDate` 狀態
2. `handleSelectFlight` 中的 `returnDateToUse` 優先順序不正確

### 修正項目
✅ **HomePage.tsx 第 58 行**: 添加 `setDepartureDate(params.date)` 確保出發日期被保存  
✅ **HomePage.tsx 第 62-63 行**: 添加更詳細的 console.log 追蹤回程日期  
✅ **HomePage.tsx 第 175 行**: 修正回程日期優先順序為 `selectedDateRange.end || searchParams.returnDate || displayDate`  
✅ **HomePage.tsx 第 180-184 行**: 添加詳細的 debug 日誌

## 🧪 測試步驟

### 基本測試流程
1. 打開瀏覽器到 `http://localhost:5175/`
2. 按 F12 打開開發者工具，切換到 Console 標籤
3. 進行以下測試：

### 測試案例 1: 台北 ⟷ 東京
```
票種: 來回
出發地: 台北 TPE
目的地: 東京 NRT
出發日期: 2024-10-17
回程日期: 2024-10-19
艙等: 經濟艙
```

**預期結果:**
- 應該顯示 2 個去程航班 (JX297, JX299)
- 選擇去程後，應該顯示 2 個回程航班 (JX446, JX448)

**Console 應顯示:**
```
SearchForm - 提交搜尋: { returnDate: "2024-10-19", ... }
HomePage - 收到搜尋參數: { returnDate: "2024-10-19", ... }
回程日期: 2024-10-19
設置回程日期範圍: 2024-10-17 - 2024-10-19
選擇去程航班，準備顯示回程航班
searchParams.returnDate: 2024-10-19
selectedDateRange.end: 2024-10-19
最終使用的回程日期: 2024-10-19
找到 2 個回程航班
```

### 測試案例 2: 台北 ⟷ 大阪
```
票種: 來回
出發地: 台北 TPE
目的地: 大阪 KIX
出發日期: 2024-10-18
回程日期: 2024-10-21
艙等: 商務艙
```

### 測試案例 3: 台北 ⟷ 首爾
```
票種: 來回
出發地: 台北 TPE
目的地: 首爾 ICN
出發日期: 2024-10-20
回程日期: 2024-10-23
艙等: 經濟艙
```

## 🐛 Debug 檢查清單

如果回程航班仍然沒有顯示，請檢查 Console 中的以下訊息：

### 1. 搜尋參數是否正確傳遞？
```javascript
✓ "SearchForm - 提交搜尋:" 應該包含 returnDate
✓ "HomePage - 收到搜尋參數:" 應該包含 returnDate
✓ "設置回程日期範圍:" 應該顯示正確的日期範圍
```

### 2. 去程航班選擇後的日誌
```javascript
✓ "選擇去程航班，準備顯示回程航班"
✓ "searchParams.returnDate:" 應該有值
✓ "selectedDateRange.end:" 應該有值
✓ "最終使用的回程日期:" 應該是正確的回程日期
```

### 3. 航班過濾條件
```javascript
✓ "回程出發地:" 應該是原本的目的地
✓ "回程目的地:" 應該是原本的出發地
✓ 每個航班檢查應該顯示匹配結果
✓ "找到 X 個回程航班" 應該 > 0
```

## 📊 可用的測試數據

系統中有以下來回航班可用 (2024-10-13 到 2024-10-25):

### 東北亞航線 (每天 2 班)
- 台北 TPE ⟷ 東京 NRT
- 台北 TPE ⟷ 東京 HND
- 台北 TPE ⟷ 大阪 KIX
- 台北 TPE ⟷ 福岡 FUK
- 台北 TPE ⟷ 名古屋 NGO
- 台北 TPE ⟷ 首爾 ICN

### 中港澳航線 (每天 2 班)
- 台北 TPE ⟷ 香港 HKG
- 台北 TPE ⟷ 澳門 MFM
- 台北 TPE ⟷ 上海 PVG
- 台北 TPE ⟷ 北京 PEK
- 台北 TPE ⟷ 廣州 CAN

### 其他航線 (每天 1 班)
- 台北 TPE ⟷ 新加坡 SIN
- 台北 TPE ⟷ 曼谷 BKK
- 台北 TPE ⟷ 馬尼拉 MNL
- 台北 TPE ⟷ 胡志明市 SGN
- 台北 TPE ⟷ 河內 HAN
- 台北 TPE ⟷ 洛杉磯 LAX
- 台北 TPE ⟷ 舊金山 SFO
- 台北 TPE ⟷ 西雅圖 SEA
- 台北 TPE ⟷ 倫敦 LHR
- 台北 TPE ⟷ 雪梨 SYD

### 松山機場航線 (每天 1 班)
- 台北松山 TSA ⟷ 東京 HND
- 台北松山 TSA ⟷ 大阪 KIX
- 台北松山 TSA ⟷ 首爾 ICN
- 台北松山 TSA ⟷ 香港 HKG
- 台北松山 TSA ⟷ 上海 PVG

## ✅ 如果一切正常

回程航班應該會正常顯示，並且：
1. 去程和回程的航班卡片都有日期顯示
2. 價格根據艙等正確顯示
3. 選擇回程後，兩張機票會一起加入購物車
4. 在購物車頁面可以看到兩張機票

## 🌐 開發伺服器

當前運行在: `http://localhost:5175/`

重新啟動開發伺服器:
```bash
cd "/Users/amy/Desktop/Uni/114 Third Year/Web_Programming/wp1141/hw3"
npm run dev
```

