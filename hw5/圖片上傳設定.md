# 🖼️ 圖片上傳功能設定指南

Echo 支援使用者自行上傳頭貼和背景圖。有兩種方式：

## 方式 1：使用 Cloudinary（推薦，免費）

### 為什麼選擇 Cloudinary？
- ✅ 免費帳號 25GB 儲存空間
- ✅ 自動圖片優化和調整大小
- ✅ 快速 CDN 傳輸
- ✅ 無需後端處理
- ✅ 適合部署到 Vercel

---

## 📝 Cloudinary 設定步驟（5 分鐘）

### 1. 註冊 Cloudinary 帳號

1. 前往 [Cloudinary](https://cloudinary.com/)
2. 點擊 **Sign Up for Free**
3. 使用 Email 或 Google 註冊
4. 驗證 email

### 2. 取得 Cloud Name

1. 登入後，進入 Dashboard
2. 找到 **Product Environment Credentials**
3. 複製 **Cloud Name**（例如：`dxyz123`）

### 3. 建立 Upload Preset

1. 左側選單：**Settings** → **Upload**
2. 捲到 **Upload presets** 區塊
3. 點擊 **Add upload preset**
4. 設定如下：
   ```
   Preset name: echo_preset
   Signing Mode: Unsigned
   Folder: echo/profiles (選填，用來整理圖片)
   ```
5. **Access mode**: Public
6. 點擊 **Save**

### 4. 設定圖片處理（選填但推薦）

在同一個 Upload Preset 設定頁面：

**針對頭像（Avatar）：**
- Transformation mode: Incoming Transformation
- Transformation:
  ```
  Width: 400
  Height: 400
  Crop: fill
  Quality: auto
  Format: auto
  ```

**針對背景圖（Cover）：**
- Width: 1500
- Height: 500
- Crop: fill
- Quality: auto
- Format: auto

### 5. 更新 .env

```bash
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="dxyz123"  # 替換成你的 Cloud Name
```

### 6. 重新啟動開發伺服器

```bash
npm run dev
```

---

## 方式 2：使用 Base64（開發用）

如果你不想設定 Cloudinary，Echo 會自動使用 base64 編碼儲存圖片到資料庫。

### ⚠️ 限制

- 圖片會變成很長的文字儲存在資料庫
- 會增加資料庫大小
- 載入速度較慢
- **不推薦正式環境使用**

### 使用方法

不需要任何設定，只要 `.env` 沒有設定 `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`，就會自動使用 base64。

---

## 🎯 使用圖片上傳功能

### 1. 上傳頭貼

1. 進入個人資料頁面
2. 點擊 **Edit Profile**
3. 方式 A：將滑鼠移到頭像上，點擊相機圖示
4. 方式 B：點擊「上傳頭像」按鈕
5. 選擇圖片檔案（最大 5MB）
6. 等待上傳完成
7. 點擊「儲存」

### 2. 上傳背景圖

1. 進入個人資料頁面
2. 點擊 **Edit Profile**
3. 將滑鼠移到背景圖區域
4. 點擊「上傳背景圖」按鈕
5. 選擇圖片檔案（最大 5MB）
6. 等待上傳完成
7. 點擊「儲存」

### 3. 使用 URL（兩種方式都支援）

你也可以直接輸入圖片 URL：
- 從其他網站複製圖片網址
- 貼到「或輸入 URL」欄位
- 點擊「儲存」

---

## ⚙️ 技術細節

### 支援的圖片格式

- JPEG / JPG
- PNG
- GIF
- WEBP
- SVG

### 圖片大小限制

- 最大：5MB
- 建議：
  - 頭像：500KB 以內
  - 背景圖：1MB 以內

### 自動處理（僅 Cloudinary）

- 自動轉換為最適合的格式（WebP/AVIF）
- 自動調整大小
- 自動壓縮
- 自動套用 CDN 加速

---

## 🐛 常見問題

### Q1: 上傳失敗「圖片上傳失敗，請稍後再試」

**可能原因：**
1. Cloudinary Cloud Name 設定錯誤
2. Upload Preset 名稱不是 `echo_preset`
3. Upload Preset 的 Signing Mode 不是 `Unsigned`

**解決方法：**
1. 檢查 `.env` 的 `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`
2. 檢查 Cloudinary 的 Upload Preset 設定
3. 重新啟動開發伺服器

### Q2: 圖片上傳很慢

**原因：** 圖片太大

**解決方法：**
1. 使用圖片壓縮工具（如 [TinyPNG](https://tinypng.com/)）
2. 調整圖片尺寸：
   - 頭像：400x400px
   - 背景：1500x500px

### Q3: 可以上傳 GIF 動畫嗎？

可以！Cloudinary 支援 GIF，但建議：
- 檔案大小 < 2MB
- 尺寸不要太大

### Q4: Base64 模式下圖片無法顯示

**可能原因：** 資料庫欄位長度限制

**解決方法：**
1. 使用 Cloudinary（推薦）
2. 或確保資料庫 `image` 和 `coverImage` 欄位類型為 `TEXT` 或 `MEDIUMTEXT`

---

## 🚀 部署到 Vercel

### 設定環境變數

1. 前往 Vercel 專案設定
2. **Settings** → **Environment Variables**
3. 新增：
   ```
   NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME = your-cloud-name
   ```
4. 點擊 **Save**
5. 重新部署

---

## 💡 進階設定

### 自訂 Upload Preset 名稱

如果你想用不同的 preset 名稱：

1. 修改 `src/components/profile/EditProfileModal.tsx`：
   ```typescript
   formData.append('upload_preset', 'your_custom_preset')
   ```

### 設定圖片資料夾結構

在 Cloudinary Upload Preset 設定：
```
Folder: echo/${userId}
```

這樣每個使用者的圖片會放在各自的資料夾。

### 啟用圖片審查（防止不當內容）

Cloudinary Dashboard → **Add-ons** → **AWS Rekognition Moderation**

---

## 📊 Cloudinary 免費額度

- **儲存空間：** 25 GB
- **每月流量：** 25 GB
- **每月轉換：** 25,000 次
- **影片：** 支援（但本專案未使用）

對於作業或小型專案來說，綽綽有餘！

---

## ✅ 完成檢查

- [ ] 註冊 Cloudinary 帳號
- [ ] 取得 Cloud Name
- [ ] 建立 `echo_preset` Upload Preset
- [ ] 設定為 Unsigned
- [ ] 更新 `.env` 加入 `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`
- [ ] 重新啟動開發伺服器
- [ ] 測試上傳頭貼
- [ ] 測試上傳背景圖
- [ ] 部署到 Vercel 並設定環境變數

---

## 🆘 需要幫助？

如果設定遇到問題：

1. 檢查 Browser Console 是否有錯誤訊息
2. 檢查 Cloudinary Dashboard 的 **Media Library** 看圖片是否有上傳
3. 參考 Cloudinary 官方文件：https://cloudinary.com/documentation

搞定！🎉

